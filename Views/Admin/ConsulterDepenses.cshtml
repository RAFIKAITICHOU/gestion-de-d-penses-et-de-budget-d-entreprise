@model List<GestionBudget_V2.Models.Depense>
@{
    ViewData["Title"] = "Consulter les Dépenses";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    /* Variables de couleurs */
    :root {
        --primary-color: #4e73df;
        --success-color: #1cc88a;
        --info-color: #36b9cc;
        --warning-color: #f6c23e;
        --danger-color: #e74a3b;
        --light-bg: #f8f9fc;
        --card-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
    }

    /* En-tete */
    .page-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, #224abe 100%);
        border-radius: 12px;
        padding: 1.5rem 2rem;
        margin-bottom: 1.5rem;
        color: white;
        box-shadow: var(--card-shadow);
    }

    .page-header h1 {
        margin: 0;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .page-header .header-icon {
        width: 45px;
        height: 45px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }

    .export-btn {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        border: none;
    }

    .export-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .export-btn-csv {
        background: var(--success-color);
        color: white;
    }

    .export-btn-csv:hover {
        background: #17a673;
        color: white;
    }

    .export-btn-pdf {
        background: var(--danger-color);
        color: white;
    }

    .export-btn-pdf:hover {
        background: #c0392b;
        color: white;
    }

    /* Carte de filtres */
    .filter-card {
        background: white;
        border-radius: 12px;
        box-shadow: var(--card-shadow);
        border: none;
        margin-bottom: 1.5rem;
        overflow: hidden;
    }

    .filter-card .card-header {
        background: linear-gradient(135deg, #f8f9fc 0%, #eaecf4 100%);
        border-bottom: 1px solid #e3e6f0;
        padding: 1rem 1.5rem;
    }

    .filter-card .card-header h6 {
        color: var(--primary-color);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 0;
    }

    .filter-card .card-body {
        padding: 1.5rem;
    }

    .filter-card .form-label {
        font-weight: 500;
        color: #5a5c69;
        margin-bottom: 0.5rem;
    }

    .filter-card .form-control,
    .filter-card .form-select {
        border-radius: 8px;
        border: 1px solid #d1d3e2;
        padding: 0.6rem 1rem;
        transition: all 0.3s ease;
    }

    .filter-card .form-control:focus,
    .filter-card .form-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.15);
    }

    .filter-btn {
        padding: 0.6rem 1.5rem;
        border-radius: 8px;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
    }

    .filter-btn:hover {
        transform: translateY(-1px);
    }

    /* Cartes statistiques */
    .stat-card {
        background: white;
        border-radius: 12px;
        box-shadow: var(--card-shadow);
        border: none;
        border-left: 4px solid;
        transition: all 0.3s ease;
        height: 100%;
    }

    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 0.5rem 2rem rgba(58, 59, 69, 0.15);
    }

    .stat-card.primary {
        border-left-color: var(--primary-color);
    }

    .stat-card.success {
        border-left-color: var(--success-color);
    }

    .stat-card.info {
        border-left-color: var(--info-color);
    }

    .stat-card.warning {
        border-left-color: var(--warning-color);
    }

    .stat-card .card-body {
        padding: 1.25rem;
    }

    .stat-card .stat-label {
        font-size: 0.7rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.5rem;
    }

    .stat-card .stat-value {
        font-size: 1.25rem;
        font-weight: 700;
        color: #3a3b45;
    }

    .stat-card .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
    }

    .stat-card.primary .stat-icon {
        background: linear-gradient(135deg, var(--primary-color) 0%, #224abe 100%);
    }

    .stat-card.success .stat-icon {
        background: linear-gradient(135deg, var(--success-color) 0%, #17a673 100%);
    }

    .stat-card.info .stat-icon {
        background: linear-gradient(135deg, var(--info-color) 0%, #258391 100%);
    }

    .stat-card.warning .stat-icon {
        background: linear-gradient(135deg, var(--warning-color) 0%, #dda20a 100%);
    }

    /* Tableau */
    .table-card {
        background: white;
        border-radius: 12px;
        box-shadow: var(--card-shadow);
        border: none;
        overflow: hidden;
    }

    .table-card .card-header {
        background: linear-gradient(135deg, #f8f9fc 0%, #eaecf4 100%);
        border-bottom: 1px solid #e3e6f0;
        padding: 1rem 1.5rem;
    }

    .table-card .card-header h6 {
        color: var(--primary-color);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 0;
    }

    .table-card .card-body {
        padding: 0;
    }

    .table-card .table {
        margin-bottom: 0;
    }

    .table-card .table thead {
        background: linear-gradient(135deg, #5a5c69 0%, #3a3b45 100%);
    }

    .table-card .table thead th {
        border: none;
        color: white;
        font-weight: 600;
        padding: 1rem;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .table-card .table tbody td {
        padding: 1rem;
        vertical-align: middle;
        border-bottom: 1px solid #e3e6f0;
    }

    .table-card .table tbody tr {
        transition: all 0.2s ease;
    }

    .table-card .table tbody tr:hover {
        background-color: #f8f9fc;
    }

    /* Badges */
    .badge-id {
        background: linear-gradient(135deg, var(--primary-color) 0%, #224abe 100%);
        color: white;
        padding: 0.4rem 0.8rem;
        border-radius: 6px;
        font-weight: 600;
        font-size: 0.8rem;
    }

    .badge-category {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 500;
        font-size: 0.8rem;
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
    }

    .badge-category.fournitures {
        background: rgba(78, 115, 223, 0.15);
        color: var(--primary-color);
    }

    .badge-category.equipement {
        background: rgba(28, 200, 138, 0.15);
        color: var(--success-color);
    }

    .badge-category.services {
        background: rgba(54, 185, 204, 0.15);
        color: var(--info-color);
    }

    .badge-category.formation {
        background: rgba(246, 194, 62, 0.15);
        color: #b7950b;
    }

    .badge-category.deplacement {
        background: rgba(231, 74, 59, 0.15);
        color: var(--danger-color);
    }

    .badge-category.autre {
        background: rgba(133, 135, 150, 0.15);
        color: #858796;
    }

    .montant-display {
        font-weight: 700;
        color: var(--success-color);
        font-size: 0.95rem;
    }

    .date-display {
        color: #5a5c69;
        font-size: 0.9rem;
    }

    .description-text {
        max-width: 200px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* Boutons d'action */
    .btn-details {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-weight: 500;
        font-size: 0.85rem;
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        transition: all 0.3s ease;
        background: linear-gradient(135deg, var(--info-color) 0%, #258391 100%);
        border: none;
        color: white;
    }

    .btn-details:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(54, 185, 204, 0.4);
        color: white;
    }

    /* Etat vide */
    .empty-state {
        padding: 4rem 2rem;
        text-align: center;
    }

    .empty-state .empty-icon {
        width: 100px;
        height: 100px;
        background: linear-gradient(135deg, #f8f9fc 0%, #eaecf4 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.5rem;
        font-size: 2.5rem;
        color: var(--primary-color);
    }

    .empty-state h4 {
        color: #3a3b45;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .empty-state p {
        color: #858796;
        margin-bottom: 0;
    }

    /* Badge compteur */
    .count-badge {
        background: linear-gradient(135deg, var(--primary-color) 0%, #224abe 100%);
        color: white;
        padding: 0.4rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.85rem;
    }

    /* Barre de recherche */
    .search-box {
        position: relative;
        margin-bottom: 1rem;
        padding: 0 1.5rem;
    }

    .search-box input {
        padding-left: 2.5rem;
        border-radius: 8px;
        border: 1px solid #d1d3e2;
    }

    .search-box input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.15);
    }

    .search-box .search-icon {
        position: absolute;
        left: 2.25rem;
        top: 50%;
        transform: translateY(-50%);
        color: #858796;
    }

    /* Modal ameliore */
    .modal-details .modal-content {
        border: none;
        border-radius: 12px;
        box-shadow: 0 0.5rem 2rem rgba(0, 0, 0, 0.2);
    }

    .modal-details .modal-header {
        background: linear-gradient(135deg, var(--info-color) 0%, #258391 100%);
        color: white;
        border-radius: 12px 12px 0 0;
        padding: 1.25rem 1.5rem;
    }

    .modal-details .modal-header .modal-title {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
    }

    .modal-details .modal-header .btn-close {
        filter: brightness(0) invert(1);
        opacity: 0.8;
    }

    .modal-details .modal-body {
        padding: 1.5rem;
    }

    .modal-details .detail-row {
        display: flex;
        padding: 0.75rem 0;
        border-bottom: 1px solid #e3e6f0;
    }

    .modal-details .detail-row:last-child {
        border-bottom: none;
    }

    .modal-details .detail-label {
        width: 140px;
        font-weight: 600;
        color: #5a5c69;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .modal-details .detail-value {
        flex: 1;
        color: #3a3b45;
    }

    .modal-details .modal-footer {
        border-top: 1px solid #e3e6f0;
        padding: 1rem 1.5rem;
    }

    /* Responsive */
    @@media (max-width: 992px) {
        .page-header {
            flex-direction: column;
            gap: 1rem;
            text-align: center;
        }

        .page-header h1 {
            justify-content: center;
        }

        .export-buttons {
            width: 100%;
            justify-content: center;
        }

        .filter-card .filter-buttons {
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-card .filter-buttons .btn {
            width: 100%;
        }
    }

    @@media (max-width: 768px) {
        .page-header h1 {
            font-size: 1.25rem;
        }

        .stat-card .stat-value {
            font-size: 1rem;
        }

        .stat-card .stat-icon {
            width: 40px;
            height: 40px;
            font-size: 1.2rem;
        }

        .table-card .table thead th {
            font-size: 0.75rem;
            padding: 0.75rem 0.5rem;
        }

        .table-card .table tbody td {
            padding: 0.75rem 0.5rem;
            font-size: 0.85rem;
        }

        .hide-mobile {
            display: none !important;
        }

        .export-buttons {
            flex-direction: column;
            gap: 0.5rem;
        }

        .export-btn {
            width: 100%;
            justify-content: center;
        }
    }

    /* Styles pour les en-têtes de tableau */
    .table thead th {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%) !important;
        color: white !important;
        border: none !important;
        font-weight: 600;
        padding: 1rem 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.8rem;
        position: relative;
        overflow: hidden;
    }

    .table thead th::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 50%);
        pointer-events: none;
    }

    /* Couleurs différentes pour chaque type de tableau */
    .table-professional thead th {
        background: linear-gradient(135deg, #4A90A4 0%, #3A7A94 100%) !important;
    }

    .table-modern thead th {
        background: linear-gradient(135deg, #5BA4B5 0%, #4A90A4 100%) !important;
    }

    .data-table thead th {
        background: linear-gradient(135deg, #6C8EA4 0%, #5BA4B5 100%) !important;
    }

    /* Style pour les icônes dans les en-têtes */
    .table thead th i {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 0.9rem;
    }

    /* Hover effect sur les en-têtes */
    .table thead th:hover {
        background: linear-gradient(135deg, var(--primary-dark) 0%, #2A6A84 100%) !important;
        transform: translateY(-1px);
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    /* Style pour le texte des en-têtes */
    .table thead th {
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    /* Responsive */
    @@media
    (max-width: 768px) {
        .table thead th {
            padding: 0.75rem 0.5rem;
            font-size: 0.75rem;
        }

        .table thead th i {
            font-size: 0.8rem;
        }
    }
</style>

<div class="container-fluid">
    <!-- En-tete -->
    <div class="page-header d-flex justify-content-between align-items-center flex-wrap">
        <h1 class="h3">
            <div class="header-icon">
                <i class="bi bi-cash-stack"></i>
            </div>
            Consulter les Depenses
        </h1>
        <div class="export-buttons d-flex gap-2 flex-wrap">
            <a href="@Url.Action("ExportCsvDepenses", "Admin")" class="export-btn export-btn-csv">
                <i class="bi bi-filetype-csv"></i> Export CSV
            </a>
            <a href="@Url.Action("ExportPdfDepenses", "Admin")" class="export-btn export-btn-pdf">
                <i class="bi bi-file-earmark-pdf"></i> Export PDF
            </a>
        </div>
    </div>

    <!-- Filtres -->
    <div class="card filter-card">
        <div class="card-header">
            <h6><i class="bi bi-funnel"></i> Filtres de recherche</h6>
        </div>
        <div class="card-body">
            <form method="get" class="row g-3 align-items-end">
                <div class="col-lg-3 col-md-6">
                    <label for="categorie" class="form-label">
                        <i class="bi bi-tag text-primary"></i> Categorie
                    </label>
                    <select class="form-select" id="categorie" name="categorie">
                        <option value="">Toutes les categories</option>
                        <option value="Fournitures">Fournitures</option>
                        <option value="Équipement">Equipement</option>
                        <option value="Services">Services</option>
                        <option value="Formation">Formation</option>
                        <option value="Déplacement">Deplacement</option>
                        <option value="Autre">Autre</option>
                    </select>
                </div>
                <div class="col-lg-3 col-md-6">
                    <label for="dateDebut" class="form-label">
                        <i class="bi bi-calendar-event text-success"></i> Date debut
                    </label>
                    <input type="date" class="form-control" id="dateDebut" name="dateDebut">
                </div>
                <div class="col-lg-3 col-md-6">
                    <label for="dateFin" class="form-label">
                        <i class="bi bi-calendar-check text-info"></i> Date fin
                    </label>
                    <input type="date" class="form-control" id="dateFin" name="dateFin">
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="filter-buttons d-flex gap-2">
                        <button type="submit" class="btn btn-primary filter-btn">
                            <i class="bi bi-search"></i> Filtrer
                        </button>
                        <a href="@Url.Action("ConsulterDepenses")" class="btn btn-outline-secondary filter-btn">
                            <i class="bi bi-arrow-counterclockwise"></i> Reset
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Statistiques -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="stat-card primary">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="stat-label text-primary">Total Depenses</div>
                            <div class="stat-value">@Model.Sum(d => d.Montant).ToString("N2") MAD</div>
                        </div>
                        <div class="stat-icon">
                            <i class="bi bi-wallet2"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="stat-card success">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="stat-label text-success">Nombre de Depenses</div>
                            <div class="stat-value">@Model.Count</div>
                        </div>
                        <div class="stat-icon">
                            <i class="bi bi-receipt"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="stat-card info">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="stat-label text-info">Depense Moyenne</div>
                            <div class="stat-value">
                                @(Model.Count > 0 ? Model.Average(d => d.Montant).ToString("N2") + " MAD" : "0,00 MAD")
                            </div>
                        </div>
                        <div class="stat-icon">
                            <i class="bi bi-graph-up"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="stat-card warning">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="stat-label text-warning">Derniere Depense</div>
                            <div class="stat-value">
                                @(Model.OrderByDescending(d =>
                                                                d.Date_depense).FirstOrDefault()?.Date_depense.ToString("dd/MM/yyyy") ?? "Aucune")
                            </div>
                        </div>
                        <div class="stat-icon">
                            <i class="bi bi-clock-history"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tableau des depenses -->
    <div class="card table-card">
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <h6><i class="bi bi-table"></i> Liste des Depenses</h6>
                <span class="count-badge">@Model.Count depense(s)</span>
            </div>
        </div>

        @if (Model.Any())
        {
            <!-- Barre de recherche -->
            <div class="search-box pt-3">
                <i class="bi bi-search search-icon"></i>
                <input type="text" id="searchTable" class="form-control" placeholder="Rechercher dans le tableau...">
            </div>
        }

        <div class="card-body">
            @if (Model.Any())
            {
                <div class="table-responsive">
                    <table class="table table-hover" id="depensesTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Date</th>
                                <th>Categorie</th>
                                <th class="hide-mobile">Description</th>
                                <th>Montant</th>
                                <th class="hide-mobile">Date Creation</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var depense in Model.OrderByDescending(d => d.Date_depense))
                            {
                                var categoryClass = depense.Categorie?.ToLower().Replace("é", "e").Replace("ô", "o") ?? "autre";
                                if (categoryClass.Contains("fournitures")) categoryClass = "fournitures";
                                else if (categoryClass.Contains("equip")) categoryClass = "equipement";
                                else if (categoryClass.Contains("service")) categoryClass = "services";
                                else if (categoryClass.Contains("formation")) categoryClass = "formation";
                                else if (categoryClass.Contains("deplac")) categoryClass = "deplacement";
                                else categoryClass = "autre";

                                <tr>
                                    <td><span class="badge-id">#@depense.Id_depense</span></td>
                                    <td><span class="date-display">@depense.Date_depense.ToString("dd/MM/yyyy")</span></td>
                                    <td>
                                        <span class="badge-category @categoryClass">
                                            <i class="bi bi-tag-fill"></i> @depense.Categorie
                                        </span>
                                    </td>
                                    <td class="hide-mobile">
                                        @if (string.IsNullOrEmpty(depense.Description))
                                        {
                                            <span class="text-muted fst-italic">Aucune description</span>
                                        }
                                        else
                                        {
                                            <span class="description-text" title="@depense.Description">
                                                @(depense.Description.Length > 40 ? depense.Description.Substring(0, 40) + "..." :
                                                                                    depense.Description)
                                            </span>
                                        }
                                    </td>
                                    <td><span class="montant-display">@depense.Montant.ToString("N2") MAD</span></td>
                                    <td class="hide-mobile">
                                        <span class="date-display">@depense.DateCreation.ToString("dd/MM/yyyy HH:mm")</span>
                                    </td>
                                    <td>
                                        <button class="btn-details" data-depense-id="@depense.Id_depense"
                                            data-categorie="@depense.Categorie"
                                            data-date="@depense.Date_depense.ToString("dd/MM/yyyy")"
                                            data-description="@depense.Description" data-montant="@depense.Montant"
                                            data-date-creation="@depense.DateCreation.ToString("dd/MM/yyyy HH:mm")">
                                            <i class="bi bi-eye"></i> Details
                                        </button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="bi bi-cash-stack"></i>
                    </div>
                    <h4>Aucune depense enregistree</h4>
                    <p>Aucune depense ne correspond a vos criteres de recherche</p>
                </div>
            }
        </div>
    </div>
</div>

<!-- Modal pour les details -->
<div class="modal fade modal-details" id="depenseModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-receipt"></i> Details de la Depense
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="detail-row">
                    <div class="detail-label"><i class="bi bi-hash"></i> ID</div>
                    <div class="detail-value" id="modalId"></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label"><i class="bi bi-calendar3"></i> Date</div>
                    <div class="detail-value" id="modalDate"></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label"><i class="bi bi-tag"></i> Categorie</div>
                    <div class="detail-value" id="modalCategorie"></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label"><i class="bi bi-text-paragraph"></i> Description</div>
                    <div class="detail-value" id="modalDescription"></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label"><i class="bi bi-currency-dollar"></i> Montant</div>
                    <div class="detail-value fw-bold text-success" id="modalMontant"></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label"><i class="bi bi-clock"></i> Date Creation</div>
                    <div class="detail-value" id="modalDateCreation"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-lg"></i> Fermer
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modals de notification -->
<div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title"><i class="bi bi-check-circle me-2"></i>Succes</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center py-4">
                <i class="bi bi-check-circle text-success" style="font-size: 3rem;"></i>
                <p class="mt-3 mb-0" id="successMessage"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" data-bs-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="errorModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="bi bi-x-circle me-2"></i>Erreur</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center py-4">
                <i class="bi bi-x-circle text-danger" style="font-size: 3rem;"></i>
                <p class="mt-3 mb-0" id="errorMessage"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="warningModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title"><i class="bi bi-exclamation-triangle me-2"></i>Attention</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center py-4">
                <i class="bi bi-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                <p class="mt-3 mb-0" id="warningMessage"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-warning" data-bs-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="infoModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title"><i class="bi bi-info-circle me-2"></i>Information</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center py-4">
                <i class="bi bi-info-circle text-info" style="font-size: 3rem;"></i>
                <p class="mt-3 mb-0" id="infoMessage"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info text-white" data-bs-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Gestion des boutons de details
            var detailButtons = document.querySelectorAll('.btn-details');
            detailButtons.forEach(function (button) {
                button.addEventListener('click', function () {
                    var id = this.getAttribute('data-depense-id');
                    var categorie = this.getAttribute('data-categorie');
                    var date = this.getAttribute('data-date');
                    var description = this.getAttribute('data-description');
                    var montant = parseFloat(this.getAttribute('data-montant'));
                    var dateCreation = this.getAttribute('data-date-creation');

                    document.getElementById('modalId').innerHTML = '<span class="badge bg-primary">#' + id + '</span>';
                    document.getElementById('modalDate').textContent = date;
                    document.getElementById('modalCategorie').innerHTML = '<span class="badge bg-info">' + categorie + '</span>';
                    document.getElementById('modalDescription').textContent = description || 'Aucune description';
                    document.getElementById('modalMontant').textContent = new Intl.NumberFormat('fr-FR', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    }).format(montant) + ' MAD';
                    document.getElementById('modalDateCreation').textContent = dateCreation;

                    var modal = new bootstrap.Modal(document.getElementById('depenseModal'));
                    modal.show();
                });
            });

            // Recherche dans le tableau
            var searchInput = document.getElementById('searchTable');
            if (searchInput) {
                searchInput.addEventListener('keyup', function () {
                    var filter = this.value.toLowerCase();
                    var rows = document.querySelectorAll('#depensesTable tbody tr');
                    rows.forEach(function (row) {
                        var text = row.textContent.toLowerCase();
                        row.style.display = text.includes(filter) ? '' : 'none';
                    });
                });
            }

            // Appliquer les filtres depuis l'URL
            const urlParams = new URLSearchParams(window.location.search);
            if (document.getElementById('categorie')) {
                document.getElementById('categorie').value = urlParams.get('categorie') || '';
            }
            if (document.getElementById('dateDebut')) {
                document.getElementById('dateDebut').value = urlParams.get('dateDebut') || '';
            }
            if (document.getElementById('dateFin')) {
                document.getElementById('dateFin').value = urlParams.get('dateFin') || '';
            }

            // Initialiser les tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });

        // Fonctions pour les modals de notification
        function showSuccessModal(message) {
            document.getElementById('successMessage').textContent = message;
            var modal = new bootstrap.Modal(document.getElementById('successModal'));
            modal.show();
        }

        function showErrorModal(message) {
            document.getElementById('errorMessage').textContent = message;
            var modal = new bootstrap.Modal(document.getElementById('errorModal'));
            modal.show();
        }

        function showWarningModal(message) {
            document.getElementById('warningMessage').textContent = message;
            var modal = new bootstrap.Modal(document.getElementById('warningModal'));
            modal.show();
        }

        function showInfoModal(message) {
            document.getElementById('infoMessage').textContent = message;
            var modal = new bootstrap.Modal(document.getElementById('infoModal'));
            modal.show();
        }

        // Afficher les messages TempData
        @if (TempData["Success"] != null)
            {
                <text>showSuccessModal("@TempData["Success"]");</text>
        }
            @if (TempData["Error"] != null)
            {
                <text>showErrorModal("@TempData["Error"]");</text>
        }
            @if (TempData["Warning"] != null)
            {
                <text>showWarningModal("@TempData["Warning"]");</text>
        }
            @if (TempData["Info"] != null)
            {
                <text>showInfoModal("@TempData["Info"]");</text>
        }
    </script>
}